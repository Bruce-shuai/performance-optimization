### 本地存储——从 Cookie 到 Web Storage、IndexedDB

随着移动网络的发展与演化，我们手机上现在除了有原生 App, 还能跑“WebApp” --- 它即开即用，用完即走(WebApp 是啥？) 一个优秀的 WebApp 甚至可以拥有和原生 App 媲美的功能和体验。

我认为, WebApp 就是我们前端性能优化的产物，是我们前端工程师对体验不懈追求的结果，是 Web 网页在性能上向 Native 应用的一次“宣战”。

WebApp 优异的性能表现，要归功于浏览器存储技术的广泛应用——这其中除了我们上节提到的缓存，本地存储技术也功不可没。

#### 故事的开始： 从 Cookie 说起

注意：Cookie 的本职工作并非本地存储，而是`“维持状态”`

在 Web 开发的早期，人们亟需解决的一个问题就是状态管理的问题：HTTP 协议是一个无状态协议，服务器接收客户端的请求，返回一个响应，故事到此就结束了，服务器并没有记录下关于客户端的任何信息。那么下次请求的时候，如何让服务器知道“我是我”呢？

在这样的背景下，Cookie 应运而生。

Cookie 说白了就是一个存储在浏览器里的一个小小的文本文件，它附着在 HTTP 请求上，在浏览器和服务器之间“飞来飞去”。它可以携带用户信息，当服务器检查 Cookie 的时候，便可以获取到客户端的状态。

![图片](./img/cookie.png)
从上图可以看见 Cookie 以键值对的形式存在。

##### Cookie 的性能劣势

###### Cookie 不够大

大家知道，Cookie 是有体积上限的，4kb 左右，不超过 5kb。这样看来, Cookie 只能用来存取少量的信息。

###### 过量的 Cookie 会带来巨大的性能浪费

**Cookie 是紧跟域名的**。我们通过响应头里的 Set-Cookie 指定要存储的 Cookie 值。**同一个域名下的所有请求，都会携带 Cookie**大家试想，如果我们此刻仅仅是请求一张图片或者一个 CSS 文件，我们也要携带一个 Cookie 跑来跑去（关键是 Cookie 里存储的信息我现在并不需要），这是一件多么劳民伤财的事情。Cookie 虽然小，请求却可以有很多，随着请求的叠加，这样的不必要的 Cookie 带来的开销将是无法想象的。**(这个说得好像还是挺有道理的)**

随着前端应用复杂度的提高，Cookie 也渐渐演化为了一个“存储多面手”——它不仅仅被用于维持状态，还被塞入了一些乱七八糟的其它信息，被迫承担起了本地存储的“重任”。在没有更好的本地存储解决方案的年代里，Cookie 小小的身体里承载了 4KB 内存所不能承受的压力。

为了弥补 Cookie 的局限性，让“专业的人做专业的事情”，Web Storage 出现了。

##### Web Storage

Web Storage 是 H5 专门为浏览器存储而提供的数据存储机制。它又分为 Local Storage 与 Session Storage

###### Local Storage 与 Session Storage 的区别

两者的区别在于`生命周期`与`作用域`的不同。

- 生命周期：Local Storage 是持久化的本地存储，存储在其中的数据是永远不会过期的，使其消失的唯一办法是手动删除；而 Session Storage 是临时性的本地存储，它是会话级别的存储，当会话结束（页面被关闭）时，存储内容也随之被释放。

- 作用域：Local Storage、Session Storage 和 Cookie 都遵循同源策略。但 Session Storage 特别的一点在于，即便是相同域名下的两个页面，只要它们不在同一个浏览器窗口中打开，那么它们的 Session Storage 内容便无法共享。

###### Web Storage 的特性

- 存储容量大： Web Storage 根据浏览器的不同，存储容量可以达到 5-10M 之间。

- 仅位于浏览器端，不与服务器发生通信
